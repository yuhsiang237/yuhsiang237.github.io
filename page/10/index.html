<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>UM&#39;s Coding Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="I record my coding experience at this place">
<meta property="og:type" content="website">
<meta property="og:title" content="UM&#39;s Coding Note">
<meta property="og:url" content="https://yuhsiang237.github.io/page/10/index.html">
<meta property="og:site_name" content="UM&#39;s Coding Note">
<meta property="og:description" content="I record my coding experience at this place">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Yu Hsiang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="UM's Coding Note" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">UM&#39;s Coding Note</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">I record my coding experience at this place🤙</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://yuhsiang237.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-C-MVC-View使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/04/C-MVC-View%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2021-10-04T04:00:51.000Z" itemprop="datePublished">2021-10-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/04/C-MVC-View%E4%BD%BF%E7%94%A8/">[Day9] C# MVC View使用 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/" title="[Day8] C# MVC Controller控制器使用 - C#&amp;AspNetCore">[Day8] C# MVC Controller控制器使用 - C#&amp;AspNetCore</a>  ，我們介紹了Controller的基本用法。</p>
<p>而這回就是使用者畫面了，也就是MVC的View</p>
<p>在這篇中會介紹:</p>
<ol>
<li>View的Razor語法</li>
<li>可共用的View 部分檢視Partial View</li>
</ol>
<h3 id="View的Razor語法"><a href="#View的Razor語法" class="headerlink" title="View的Razor語法"></a>View的Razor語法</h3><p>通常在View中看到@出現通常就是Razor語法了。<br>基本上就是印出值，再來就是一些特定用法。</p>
<ul>
<li>後端註解<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@*註解*@</span><br></pre></td></tr></table></figure></li>
<li>輸出@符號<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@@</span><br></pre></td></tr></table></figure></li>
<li>@變數名稱，取值<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@DateTime.Now</span><br></pre></td></tr></table></figure></li>
<li>陳述式<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@(5*3)</span><br></pre></td></tr></table></figure></li>
<li>程式碼區塊<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@&#123; &#125;</span><br></pre></td></tr></table></figure></li>
<li>for用法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@for (int i = 0; i &lt; 10; i++)</span><br><span class="line">&#123;</span><br><span class="line">  &lt;text&gt;</span><br><span class="line">    word   </span><br><span class="line">  &lt;/text&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>foreach用法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    string[] fruits = &#123; &quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot; &#125;;    </span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      @foreach (var item in fruits)</span><br><span class="line">      &#123;</span><br><span class="line">        &lt;li&gt;@item&lt;/li&gt;    </span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>變數<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    var name = &quot;mvc&quot;;  </span><br><span class="line">&#125;  </span><br><span class="line">&lt;p&gt;@name 您好&lt;/p&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Partial-View-部分檢視"><a href="#Partial-View-部分檢視" class="headerlink" title="Partial View 部分檢視"></a>Partial View 部分檢視</h3><p>在網頁時常會有需要<strong>共用的畫面</strong>，如側邊欄、頂端橫幅等。<br>不想要在每個頁面都寫一個，這時就會使用到Partial View把他們切出去。</p>
<p>Partial View前面會有個_底線<br>可以看到預設建立的MVC專案就有不少Partial View了。</p>
<img src="/2021/10/04/C-MVC-View%E4%BD%BF%E7%94%A8/1.png" class="">


<h5 id="ViewStart-cshtml"><a href="#ViewStart-cshtml" class="headerlink" title="_ViewStart.cshtml"></a>_ViewStart.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    Layout = &quot;_Layout&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Layout的進入點_ViewStart.cshtml在此可以選擇預設要套用的版，如一些網站會有前台、後台之分。<br>如果想把View切成前後台可以參考這篇動態切換適配的Layout:<br><a target="_blank" rel="noopener" href="https://dotblogs.com.tw/stanley14/2016/06/29/202231">https://dotblogs.com.tw/stanley14/2016/06/29/202231</a><br>其實就是在_ViewStart.cshtml這檔案做些適配而已</p>
<p>再來我們看_Layout.cs，版面前台主View</p>
<h5 id="Layout-cs"><a href="#Layout-cs" class="headerlink" title="_Layout.cs"></a>_Layout.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;@ViewData[&quot;Title&quot;] - WebApplication1&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/lib/bootstrap/dist/css/bootstrap.min.css&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">        &lt;nav class=&quot;navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;a class=&quot;navbar-brand&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;WebApplication1&lt;/a&gt;</span><br><span class="line">                &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;.navbar-collapse&quot; aria-controls=&quot;navbarSupportedContent&quot;</span><br><span class="line">                        aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                &lt;div class=&quot;navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse&quot;&gt;</span><br><span class="line">                    &lt;ul class=&quot;navbar-nav flex-grow-1&quot;&gt;</span><br><span class="line">                        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                            &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                            &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;main role=&quot;main&quot; class=&quot;pb-3&quot;&gt;</span><br><span class="line">            @RenderBody()</span><br><span class="line">        &lt;/main&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;footer class=&quot;border-top footer text-muted&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &amp;copy; 2021 - WebApplication1 - &lt;a asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/bootstrap/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/js/site.js&quot; asp-append-version=&quot;true&quot;&gt;&lt;/script&gt;</span><br><span class="line">    @RenderSection(&quot;Scripts&quot;, required: false)</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@RenderSection("Scripts", required: false)</code>用來輸出主板中區段的內容。required是指此Section是否一定要有資料顯示，如果設成true時，檢視中沒有定義此Section的值，那網頁就會掛掉。<br>子版則可以將下列區段內容輸出到主板<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@section Scripts &#123;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;~/scripts/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>@RenderBody()</code>所有被導向主版的view會被載入到@RenderBody</li>
</ul>
<h3 id="切Partial的方法"><a href="#切Partial的方法" class="headerlink" title="切Partial的方法"></a>切Partial的方法</h3><p>我們可以發現_Layout.cs有段nav區塊可以共用，把他切出去吧。</p>
<h5 id="Nav-cs"><a href="#Nav-cs" class="headerlink" title="_Nav.cs"></a>_Nav.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;nav class=&quot;navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;navbar-brand&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;WebApplication1&lt;/a&gt;</span><br><span class="line">        &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;.navbar-collapse&quot; aria-controls=&quot;navbarSupportedContent&quot;</span><br><span class="line">                aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;navbar-nav flex-grow-1&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<p>之後在_Layout將他引進</p>
<h5 id="Layout-cs-1"><a href="#Layout-cs-1" class="headerlink" title="_Layout.cs"></a>_Layout.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;@ViewData[&quot;Title&quot;] - WebApplication1&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/lib/bootstrap/dist/css/bootstrap.min.css&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">        @await Html.PartialAsync(&quot;_Nav&quot;)</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;main role=&quot;main&quot; class=&quot;pb-3&quot;&gt;</span><br><span class="line">            @RenderBody()</span><br><span class="line">        &lt;/main&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;footer class=&quot;border-top footer text-muted&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &amp;copy; 2021 - WebApplication1 - &lt;a asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/bootstrap/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/js/site.js&quot; asp-append-version=&quot;true&quot;&gt;&lt;/script&gt;</span><br><span class="line">    @RenderSection(&quot;Scripts&quot;, required: false)</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@await Html.PartialAsync("_Nav")</code> 表示用異步的方式把Partial區塊引進來。使用 HTML 協助程式時，最佳做法是使用 PartialAsync。 PartialAsync 會傳回包裝在 Task<TResult> 的 IHtmlContent 類型。 方法的參考方式，是在等候的呼叫前面加上 @ 字元。此外，目前以不建議使用同步方式載入了，因為官方說會造成死結。</li>
</ul>
<p>如此以來就會更專注在每個小區塊。</p>
<p>這時可能有人會問，Partial沒Controller怎麼載資料呢?所以要介紹另個載入的方式。</p>
<h3 id="Partial傳遞資料的方式"><a href="#Partial傳遞資料的方式" class="headerlink" title="Partial傳遞資料的方式"></a>Partial傳遞資料的方式</h3><p>我們查看<code>@await Html.PartialAsync("_Nav")</code>的函式多載，可以發現能透過Model方式將資料傳入。</p>
<img src="/2021/10/04/C-MVC-View%E4%BD%BF%E7%94%A8/2.png" class="">

<p>我們建立一個ViewModel叫NavViewModel</p>
<h5 id="NavViewModel-cs"><a href="#NavViewModel-cs" class="headerlink" title="NavViewModel.cs"></a>NavViewModel.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class NavViewModel</span><br><span class="line">    &#123;</span><br><span class="line">        public string BrandName &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>將原本的PartialAsync傳入NavViewModel</p>
<h5 id="Layout-cshtml"><a href="#Layout-cshtml" class="headerlink" title="_Layout.cshtml"></a>_Layout.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@await Html.PartialAsync(&quot;_Nav&quot;,new NavViewModel() &#123; BrandName = &quot;WebApplication1&quot; &#125;)</span><br></pre></td></tr></table></figure>
<p>之後在_Nav.cshtml顯示</p>
<h5 id="Nav-cshtml"><a href="#Nav-cshtml" class="headerlink" title="_Nav.cshtml"></a>_Nav.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.NavViewModel;</span><br><span class="line">&lt;nav class=&quot;navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;navbar-brand&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;</span><br><span class="line">            @Model.BrandName</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">        &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;.navbar-collapse&quot; aria-controls=&quot;navbarSupportedContent&quot;</span><br><span class="line">                aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;navbar-nav flex-grow-1&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@Model.BrandName</code>即可印出Model資料</li>
</ul>
<p>因為會拉出去獨立寫的通常都是固定規格，所以建議用Model，而不是用弱型別的ViewData、ViewBag方式。</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>MVC的View真的做到很嚴謹，讓整體資料有固定的方式作呈現，關鍵就在那一個View只能綁一個Model，讓資料減少亂竄的可能性。<br>而在Partial也是可以透過API方式去自行載入資料。</p>
<p>預計下篇可能還是View，會探討一些常見作法在拆頁面結構上。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10160185">https://ithelp.ithome.com.tw/articles/10160185</a><br><a target="_blank" rel="noopener" href="https://sites.google.com/site/yuedumvcbiji/4-view/layout-cshtml">https://sites.google.com/site/yuedumvcbiji/4-view/layout-cshtml</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/mvc/views/layout?view=aspnetcore-5.0">https://docs.microsoft.com/zh-tw/aspnet/core/mvc/views/layout?view=aspnetcore-5.0</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/mvc/views/partial?view=aspnetcore-5.0">https://docs.microsoft.com/zh-tw/aspnet/core/mvc/views/partial?view=aspnetcore-5.0</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10186517">https://ithelp.ithome.com.tw/articles/10186517</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10205881">https://ithelp.ithome.com.tw/articles/10205881</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10240368">https://ithelp.ithome.com.tw/articles/10240368</a><br><a target="_blank" rel="noopener" href="https://dotblogs.com.tw/stanley14/2016/06/29/202231">https://dotblogs.com.tw/stanley14/2016/06/29/202231</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/10/04/C-MVC-View%E4%BD%BF%E7%94%A8/" data-id="cme6kwo0o001jgalj5tzxcpvc" data-title="[Day9] C# MVC View使用 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C-MVC-Controller控制器使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2021-10-03T04:00:51.000Z" itemprop="datePublished">2021-10-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/">[Day8] C# MVC Controller控制器使用 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/" title="[Day7] C# MVC Model模型連結資料庫 - C#&amp;AspNetCore">[Day7] C# MVC Model模型連結資料庫 - C#&amp;AspNetCore</a>  ，我們把Model連上了資料庫，算是把Model的基礎流程跑完了。</p>
<p>這回就來看Controller吧!</p>
<p>在這篇中主要介紹Controller把資訊傳送給View，有以下方法</p>
<ol>
<li>ViewData</li>
<li>ViewBag</li>
<li>多個Model傳給View</li>
</ol>
<h3 id="控制器（Controller）"><a href="#控制器（Controller）" class="headerlink" title="控制器（Controller）"></a>控制器（Controller）</h3><p>負責轉發請求，對請求進行處理。<br>當使用者進到了前台的視圖（View），對畫面操作所觸發的事件就會跑到控制器。<br>在控制器裡負責拿到模型（Model）的資料後加上些業務邏輯後返視圖(View)。<br>負責處理主要商業邏輯處理，資料格式處理，大部分介於Model 與 View 之間，處理資料流的溝通。</p>
<h3 id="建立Controller"><a href="#建立Controller" class="headerlink" title="建立Controller"></a>建立Controller</h3><p>1.在Controller資料夾Add &gt; Controller</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/1.png" class="">
<p>2.選Empty</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/2.png" class="">
<p>3.MVC Controller Empty</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/3.png" class="">
<p>4.接下來會產生程式碼，我們增加一行ViewData的程式碼</p>
<h5 id="TestController-cs"><a href="#TestController-cs" class="headerlink" title="TestController.cs"></a>TestController.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    public class TestController : Controller</span><br><span class="line">    &#123;</span><br><span class="line">        public IActionResult Index()</span><br><span class="line">        &#123;</span><br><span class="line">            // 使用ViewData</span><br><span class="line">            ViewData[&quot;Message&quot;] = &quot;Hello World!&quot;;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>IActionResult:表示動作結果，即使用Post([HttpPost])或Get( [HttpGet])時會使用。</li>
<li>ViewData:表示在該View可以使用的Data，為弱型別。通常我們會多建立一個ViewModel作為強型別用，因為可以在編譯時就知道錯誤，上線後、維護也比較穩。ViewData算是有點偷懶的傳資料方式。</li>
</ul>
<p>接下來我們添加View畫面，Test&gt;Index.cshtml</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/4.png" class="">
<h5 id="Index-cshtml"><a href="#Index-cshtml" class="headerlink" title="Index.cshtml"></a>Index.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@*</span><br><span class="line">    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860</span><br><span class="line">*@</span><br><span class="line">@ViewData[&quot;Message&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如此一來就能把資料帶進來了</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/5.png" class="">

<h3 id="補充Result種類"><a href="#補充Result種類" class="headerlink" title="補充Result種類"></a>補充Result種類</h3><p>JsonResult:用來單純回傳JSON</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public JsonResult TestJsonResult()</span><br><span class="line">&#123;</span><br><span class="line">    return Json(new &#123; data = 5 &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>結果:</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/6.png" class="">

<p>FileResult:用來回傳檔案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public FileResult TestFileResult()</span><br><span class="line">&#123;</span><br><span class="line">    string excelPath = @&quot;C:\example.xlsx&quot;;</span><br><span class="line">    return File(excelPath, &quot;application/vnd.ms-excel&quot;, &quot;example.xlsx&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Controller傳多個Model進View的方法"><a href="#Controller傳多個Model進View的方法" class="headerlink" title="Controller傳多個Model進View的方法"></a>Controller傳多個Model進View的方法</h3><p>最好作法就是強型別的ViewModel了。</p>
<p>我們建立一個Model，裡面宣告Model類別屬性</p>
<h5 id="TestViewModel-cs"><a href="#TestViewModel-cs" class="headerlink" title="TestViewModel.cs"></a>TestViewModel.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class TestViewModel</span><br><span class="line">    &#123;</span><br><span class="line">        Customer Customer &#123; get; set; &#125;</span><br><span class="line">        public List&lt;Product&gt; Products &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="TestController-cs-1"><a href="#TestController-cs-1" class="headerlink" title="TestController.cs"></a>TestController.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using WebApplication1.Models;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    public class TestController : Controller</span><br><span class="line">    &#123;</span><br><span class="line">        public IActionResult Index()</span><br><span class="line">        &#123;</span><br><span class="line">            // 使用ViewData</span><br><span class="line">            ViewData[&quot;Message&quot;] = &quot;Hello World!&quot;;</span><br><span class="line"></span><br><span class="line">            TestViewModel testViewModel = new TestViewModel();</span><br><span class="line">            testViewModel.Customer = new Customer() ;</span><br><span class="line">            testViewModel.Customer.Name = &quot;YU HSIANG&quot;;</span><br><span class="line">            testViewModel.Customer.Number = &quot;A001&quot;;</span><br><span class="line">            testViewModel.Customer.Tel = &quot;00-00000000&quot;;</span><br><span class="line"></span><br><span class="line">            testViewModel.Products = new List&lt;Product&gt;();</span><br><span class="line">            testViewModel.Products.Add(new Product() &#123; Name = &quot;PS4&quot;, Number = &quot;P001&quot;, Price = 11000 &#125;);</span><br><span class="line">            testViewModel.Products.Add(new Product() &#123; Name = &quot;PS5&quot;, Number = &quot;P002&quot;, Price = 15000 &#125;);</span><br><span class="line"></span><br><span class="line">            return View(testViewModel);</span><br><span class="line">        &#125;</span><br><span class="line">        public JsonResult TestJsonResult()</span><br><span class="line">        &#123;</span><br><span class="line">            return Json(new &#123; data = 5 &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public FileResult TestFileResult()</span><br><span class="line">        &#123;</span><br><span class="line">            string excelPath = @&quot;C:\example.xlsx&quot;;</span><br><span class="line">            return File(excelPath, &quot;application/vnd.ms-excel&quot;, &quot;example.xlsx&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Index-cshtml-1"><a href="#Index-cshtml-1" class="headerlink" title="Index.cshtml"></a>Index.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.TestViewModel</span><br><span class="line">@*</span><br><span class="line">    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860</span><br><span class="line">*@</span><br><span class="line">@ViewData[&quot;Message&quot;]&lt;br&gt;</span><br><span class="line">@Model.Customer.Name&lt;br&gt;</span><br><span class="line">@Model.Customer.Number&lt;br&gt;</span><br><span class="line">@Model.Customer.Tel&lt;br&gt;</span><br><span class="line"></span><br><span class="line">&lt;table&gt;</span><br><span class="line">@foreach (Product item in Model.Products)</span><br><span class="line">&#123;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Number)&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Name)&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Price)&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p>成功呈現多個Model，並且又是強型別</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/7.png" class="">

<h3 id="額外的方式傳值Viewbag"><a href="#額外的方式傳值Viewbag" class="headerlink" title="額外的方式傳值Viewbag"></a>額外的方式傳值Viewbag</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public IActionResult Index()</span><br><span class="line">&#123;</span><br><span class="line">    // 使用ViewData</span><br><span class="line">    ViewData[&quot;Message&quot;] = &quot;Hello World!&quot;;</span><br><span class="line"></span><br><span class="line">    //使用ViewBag</span><br><span class="line">    ViewBag.msg = &quot;使用ViewBag的資料&quot;;</span><br><span class="line"></span><br><span class="line">    TestViewModel testViewModel = new TestViewModel();</span><br><span class="line">    testViewModel.Customer = new Customer() ;</span><br><span class="line">    testViewModel.Customer.Name = &quot;YU HSIANG&quot;;</span><br><span class="line">    testViewModel.Customer.Number = &quot;A001&quot;;</span><br><span class="line">    testViewModel.Customer.Tel = &quot;00-00000000&quot;;</span><br><span class="line"></span><br><span class="line">    testViewModel.Products = new List&lt;Product&gt;();</span><br><span class="line">    testViewModel.Products.Add(new Product() &#123; Name = &quot;PS4&quot;, Number = &quot;P001&quot;, Price = 11000 &#125;);</span><br><span class="line">    testViewModel.Products.Add(new Product() &#123; Name = &quot;PS5&quot;, Number = &quot;P002&quot;, Price = 15000 &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return View(testViewModel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Index-cshtml-2"><a href="#Index-cshtml-2" class="headerlink" title="Index.cshtml"></a>Index.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.TestViewModel</span><br><span class="line">@*</span><br><span class="line">    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860</span><br><span class="line">*@</span><br><span class="line">@ViewData[&quot;Message&quot;]&lt;br&gt;</span><br><span class="line">@ViewBag.msg&lt;br&gt;</span><br><span class="line">@Model.Customer.Name</span><br><span class="line">&lt;br&gt;</span><br><span class="line">@Model.Customer.Number</span><br><span class="line">&lt;br&gt;</span><br><span class="line">@Model.Customer.Tel</span><br><span class="line">&lt;br&gt;</span><br><span class="line"></span><br><span class="line">&lt;table&gt;</span><br><span class="line">    @foreach (Product item in Model.Products)</span><br><span class="line">    &#123;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Number)&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Name)&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;@Html.TextBoxFor(m =&gt; item.Price)&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>結果:</p>
<img src="/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/8.png" class="">
<p>用ViewBag跟ViewData缺點都在弱型別，難以在編譯時就知道錯誤存在。</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>從這篇中可以知道如何透過Controller傳資料給View。<br>在下篇預計就是介紹View了。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10240345">https://ithelp.ithome.com.tw/articles/10240345</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/web-api/action-return-types?view=aspnetcore-5.0">https://docs.microsoft.com/zh-tw/aspnet/core/web-api/action-return-types?view=aspnetcore-5.0</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/10/03/C-MVC-Controller%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BD%BF%E7%94%A8/" data-id="cme6kwo0a000sgalj1iv52vul" data-title="[Day8] C# MVC Controller控制器使用 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C-MVC-Model與資料庫連結" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/" class="article-date">
  <time class="dt-published" datetime="2021-10-02T04:00:51.000Z" itemprop="datePublished">2021-10-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/">[Day7] C# MVC Model模型連結資料庫，使用Entity Framework - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/" title="[Day6] C# MVC Model模型驗證 - C#&amp;AspNetCore">[Day6] C# MVC Model模型驗證 - C#&amp;AspNetCore</a>  ，我們學會利用Model建立驗證機制。<br>而這回將會介紹如何把Model與真實的資料庫連結再一起。</p>
<h3 id="Entity-Framework"><a href="#Entity-Framework" class="headerlink" title="Entity Framework"></a>Entity Framework</h3><p>Entity Framework (又稱ADO.NET Entity Framework) 是微軟以 ADO.NET 為基礎所發展出來的物件關聯對應 (O/R Mapping) 解決方案。<br>Entity Framework 利用了抽象化資料結構的方式，將每個資料庫物件都轉換成應用程式物件 (entity)，而資料欄位都轉換為屬性 (property)，關聯則轉換為結合屬性 (association)，讓資料庫的 E/R 模型完全的轉成物件模型，如此讓程式設計師能用最熟悉的程式語言來呼叫存取。</p>
<p>簡言之，就是一個透過物件的方式去操作資料，而不透過原生SQL的作法。<br>(但我還是比較熟悉原生的SQL，因為換什麼語言寫都通，但在微軟架構下還是用他提供的會比較好)</p>
<h3 id="安裝Entity-Framework"><a href="#安裝Entity-Framework" class="headerlink" title="安裝Entity Framework"></a>安裝Entity Framework</h3><p>安裝:</p>
<ul>
<li>Microsoft.EntityFrameworkCore</li>
<li>Microsoft.EntityFrameworkCore.SqlServer</li>
<li>Microsoft.EntityFrameworkCore.Design</li>
<li>Microsoft.EntityFrameworkCore.Tools</li>
</ul>
<p>過程:<br>1.Dependencies&gt; Manage nuget packages</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/1.png" class="">
<p>2.安裝Microsoft.EntityFrameworkCore</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/2.png" class="">
<p>3.安裝Microsoft.EntityFrameworkCore.SqlServer</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/3.png" class="">
<p>4.安裝Microsoft.EntityFrameworkCore.Design</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/4.png" class="">
<p>5.安裝Microsoft.EntityFrameworkCore.Tools</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/5.png" class="">
<h3 id="使用Entity-Framework"><a href="#使用Entity-Framework" class="headerlink" title="使用Entity Framework"></a>使用Entity Framework</h3><p>Entity Framework Core 有提供兩種開發方式</p>
<ul>
<li>DB First:我已經有現有資料庫了，只是用程式去操作他。</li>
<li>Code First:我還沒有資料庫，想用程式碼去建立資料庫。</li>
<li>Model First:先定義好模型在產生資料表的方式。</li>
</ul>
<p>以我在Laravel的架構下寫過的經驗，會覺得Code First會比較好，因為有更動歷程，也比較能知道異動。<br>而DB First則是把兩者分開來做，優點是很直接，缺點就是異動後很難知道改了哪。</p>
<p>而這回主要以DB First為主。</p>
<p>1.開啟package manager console</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/6.png" class="">
<p>2.之後會出現命令列</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/7.png" class="">
<p>3.之後把SQL Server打開，看目前資料庫，我們預計把Orders資料庫給整合進來</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/8.png" class="">
<p>4.使用<code>Scaffold-DbContext</code>指令，來還原Orders資料庫的Models</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scaffold-DbContext &quot;Server=.\SQLExpress;Database=Orders;Trusted_Connection=True;&quot; Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models</span><br></pre></td></tr></table></figure>
<p>請自行替換字串的內容:</p>
<ul>
<li>Database:資料庫名稱</li>
</ul>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/9.png" class="">
<p>之後Models資料夾就會自動產生Model了</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/10.png" class="">

<p>再來至Startup.cs添加資料庫連線服務</p>
<h5 id="Startup-cs"><a href="#Startup-cs" class="headerlink" title="Startup.cs"></a>Startup.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">  &#123;</span><br><span class="line">      </span><br><span class="line">      services.AddControllersWithViews();</span><br><span class="line">      // 資料庫配置</span><br><span class="line">      var connection = @&quot;Server=.\SQLExpress;Database=Orders;Trusted_Connection=True;ConnectRetryCount=0&quot;;</span><br><span class="line">      services.AddDbContext&lt;OrdersContext&gt;(options =&gt; options.UseSqlServer(connection));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>再來至控制器HomeController.cs增加方法</p>
<h5 id="HomeController-cs"><a href="#HomeController-cs" class="headerlink" title="HomeController.cs"></a>HomeController.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;</span><br><span class="line">using Microsoft.Extensions.Logging;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using WebApplication1.Models;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    public class HomeController : Controller</span><br><span class="line">    &#123;</span><br><span class="line">        private readonly ILogger&lt;HomeController&gt; _logger;</span><br><span class="line"></span><br><span class="line">        // 添加Context</span><br><span class="line">        private readonly OrdersContext _context;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public HomeController(ILogger&lt;HomeController&gt; logger, OrdersContext context)</span><br><span class="line">        &#123;</span><br><span class="line">            _logger = logger;</span><br><span class="line">            // 初始化Context</span><br><span class="line">            _context = context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [HttpGet]</span><br><span class="line">        public IActionResult Create()</span><br><span class="line">        &#123;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [HttpPost]</span><br><span class="line">        public IActionResult Create(UsersModel usersmodel)</span><br><span class="line">        &#123;</span><br><span class="line">            if (ModelState.IsValid)</span><br><span class="line">            &#123;</span><br><span class="line">                //如果連結資料庫在這進行儲存</span><br><span class="line"></span><br><span class="line">                //導回首頁</span><br><span class="line">                return RedirectToAction(nameof(Index));</span><br><span class="line">            &#125;</span><br><span class="line">            return View(usersmodel);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public IActionResult Index()</span><br><span class="line">        &#123;</span><br><span class="line">            // 透過Context取得資料</span><br><span class="line">            var model = _context.Customers.Select(b =&gt; new Customer</span><br><span class="line">            &#123;</span><br><span class="line">                Name = b.Name,</span><br><span class="line">                Number = b.Number,</span><br><span class="line">                Tel = b.Tel</span><br><span class="line">            &#125;).ToList();</span><br><span class="line"></span><br><span class="line">            // 取第一列資料出來</span><br><span class="line">            Customer m = model[0];</span><br><span class="line"></span><br><span class="line">            return View(m);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IActionResult Privacy()</span><br><span class="line">        &#123;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]</span><br><span class="line">        public IActionResult Error()</span><br><span class="line">        &#123;</span><br><span class="line">            return View(new ErrorViewModel &#123; RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再來在View上修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.Customer;</span><br><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Home Page&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;@Model.Number&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;@Model.Name&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;@Model.Tel&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;div class=&quot;text-center&quot;&gt;</span><br><span class="line">    &lt;h1 class=&quot;display-4&quot;&gt;Welcome&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Learn about &lt;a href=&quot;https://docs.microsoft.com/aspnet/core&quot;&gt;building Web apps with ASP.NET Core&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>接下來運行即可印出第一筆資料</p>
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/11.png" class="">
<img src="/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/12.png" class="">

<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>而現在已經能成功連結資料庫了!<br>微軟MVC資料庫連結方式比較麻煩，因為要自行找套件，不像Laravel已經配好，直接打帳號密碼就能用。<br>而現在迫切問題在Controller只能傳送一個Model，要如何讓多個Model能夠透過Controller傳送到View上。<br>所以，下個篇主要介紹的就是Controller。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/data/ef-mvc/intro?view=aspnetcore-5.0">https://docs.microsoft.com/zh-tw/aspnet/core/data/ef-mvc/intro?view=aspnetcore-5.0</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/tutorials/first-mvc-app/working-with-sql?view=aspnetcore-3.1&amp;tabs=visual-studio">https://docs.microsoft.com/zh-tw/aspnet/core/tutorials/first-mvc-app/working-with-sql?view=aspnetcore-3.1&amp;tabs=visual-studio</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/ef/core/cli/dotnet#dotnet-ef-dbcontext-scaffold">https://docs.microsoft.com/zh-tw/ef/core/cli/dotnet#dotnet-ef-dbcontext-scaffold</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2m_3SHGy-Rs">https://www.youtube.com/watch?v=2m_3SHGy-Rs</a><br><a target="_blank" rel="noopener" href="http://go.microsoft.com/fwlink/?LinkId=723263">http://go.microsoft.com/fwlink/?LinkId=723263</a><br><a target="_blank" rel="noopener" href="https://www.uuu.com.tw/Public/content/article/20/20200413.htm">https://www.uuu.com.tw/Public/content/article/20/20200413.htm</a><br><a target="_blank" rel="noopener" href="http://ikevin.tw/2019/08/04/asp-net-core-3-0-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-database-first/">http://ikevin.tw/2019/08/04/asp-net-core-3-0-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-database-first/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/10/02/C-MVC-Model%E8%88%87%E8%B3%87%E6%96%99%E5%BA%AB%E9%80%A3%E7%B5%90/" data-id="cme6kwo0i0018galjewwz2iby" data-title="[Day7] C# MVC Model模型連結資料庫，使用Entity Framework - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C-MVC-Model模型驗證" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/" class="article-date">
  <time class="dt-published" datetime="2021-10-01T04:00:51.000Z" itemprop="datePublished">2021-10-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/">[Day6] C# MVC Model模型驗證 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/" title="[Day5] C# MVC Model模型使用 - C#&amp;AspNetCore">[Day5] C# MVC Model模型使用 - C#&amp;AspNetCore</a>  ，我們建立了基本的Model，並且示範讓資料藉由Model資料呈現在網頁上。<br>在這篇主要談如何Model模型上進行驗證。</p>
<h3 id="Model的驗證"><a href="#Model的驗證" class="headerlink" title="Model的驗證"></a>Model的驗證</h3><p>為了讓資料進到資料庫是符合我們要的格式，就必須在前面先擋過一層，而這層我們可以透過Model來達到。</p>
<p><strong>常見的驗證屬性</strong></p>
<ul>
<li>[ValidateNever]： ValidateNeverAttribute 指出屬性或參數應該從驗證中排除。</li>
<li>[CreditCard]：驗證屬性是否具有信用卡格式。 需要 JQuery 驗證的其他方法。</li>
<li>[Compare]：驗證模型中的兩個屬性是否相符。</li>
<li>[EmailAddress]：驗證屬性具有電子郵件格式。</li>
<li>[Phone]：驗證屬性具有電話號碼格式。</li>
<li>[Range]：驗證屬性值是否落在指定的範圍內。像是最大值(Max)、最小值(min)</li>
<li>[RegularExpression]：驗證屬性值是否符合指定的正則運算式。</li>
<li>[Required]：驗證欄位不是 null。 </li>
<li>[StringLength]：驗證字串屬性值不超過指定的長度限制。</li>
<li>[Url]：驗證屬性是否具有 URL 格式。</li>
<li>[Remote]：在伺服器上呼叫動作方法，以驗證用戶端上的輸入。</li>
<li>[Display]:顯示名稱為</li>
<li>[DataType]:資料型別</li>
</ul>
<h3 id="添加驗證屬性範例實作"><a href="#添加驗證屬性範例實作" class="headerlink" title="添加驗證屬性範例實作"></a>添加驗證屬性範例實作</h3><p>我們先在UsersModel.cs增加屬性<br>需先添加<code>using System.ComponentModel.DataAnnotations</code>才可使用驗證屬性。</p>
<h5 id="UsersModel-cs"><a href="#UsersModel-cs" class="headerlink" title="UsersModel.cs"></a>UsersModel.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.ComponentModel.DataAnnotations;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class UsersModel</span><br><span class="line">    &#123;</span><br><span class="line">        [Display(Name = &quot;編號&quot;)]</span><br><span class="line">        public int ID &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        [Required(ErrorMessage = &quot;姓名不可為空&quot;)]</span><br><span class="line">        [Display(Name = &quot;姓名&quot;)]</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        [Display(Name = &quot;年齡&quot;)]</span><br><span class="line">        public int Age &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接著在HomeController.cs裡面個添加一個HttpGet、HttpPost的Create方法<br>HttpGet是進頁面時會跑的方法<br>HttpPost是表單觸發發送後會跑的方法</p>
<h5 id="HomeController-cs"><a href="#HomeController-cs" class="headerlink" title="HomeController.cs"></a>HomeController.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[HttpGet]</span><br><span class="line">public IActionResult Create()</span><br><span class="line">&#123;</span><br><span class="line">    return View();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[HttpPost]</span><br><span class="line">public IActionResult Create(UsersModel usersmodel)</span><br><span class="line">&#123;</span><br><span class="line">    if (ModelState.IsValid)</span><br><span class="line">    &#123;</span><br><span class="line">        //如果連結資料庫在這進行儲存</span><br><span class="line"></span><br><span class="line">        //導回首頁</span><br><span class="line">        return RedirectToAction(nameof(Index));</span><br><span class="line">    &#125;</span><br><span class="line">    return View(usersmodel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著新增一個View頁面，在前台畫面上製作一個form表單。</p>
<h5 id="Create-cshtml"><a href="#Create-cshtml" class="headerlink" title="Create.cshtml"></a>Create.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.UsersModel</span><br><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Create Page&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;form asp-action=&quot;Create&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label asp-for=&quot;Name&quot;&gt;&lt;/label&gt;</span><br><span class="line">        &lt;input asp-for=&quot;Name&quot; /&gt;</span><br><span class="line">        &lt;span asp-validation-for=&quot;Name&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label asp-for=&quot;Age&quot;&gt;&lt;/label&gt;</span><br><span class="line">        &lt;input asp-for=&quot;Age&quot; /&gt;</span><br><span class="line">        &lt;span asp-validation-for=&quot;Age&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;Save&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>注意，<code>asp-validation-for="Name"</code>表示後端回傳的錯誤訊息會傳送到這裡。</p>
<p>然後至網址:<a target="_blank" rel="noopener" href="https://localhost:44378/Home/Create">https://localhost:44378/Home/Create</a> 查看後<br>名子不填儲存就會出現錯誤了</p>
<img src="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/1.gif" class="">
<p>在程式碼上會發現跑到HttpPost的Create裡面</p>
<img src="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/2.gif" class="">

<h3 id="自訂驗證"><a href="#自訂驗證" class="headerlink" title="自訂驗證"></a>自訂驗證</h3><p>系統預設的驗證肯定不夠，所以就來製作自己的驗證。</p>
<p>我們在UsersModel.cs裡面增加一個CheckValidAge的class並且繼承ValidationAttribute<br>並覆寫裡面IsValid方法。</p>
<h5 id="UsersModel-cs-1"><a href="#UsersModel-cs-1" class="headerlink" title="UsersModel.cs"></a>UsersModel.cs</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.ComponentModel.DataAnnotations;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class UsersModel</span><br><span class="line">    &#123;</span><br><span class="line">        [Display(Name = &quot;編號&quot;)]</span><br><span class="line">        public int ID &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        [Required(ErrorMessage = &quot;姓名不可為空&quot;)]</span><br><span class="line">        [Display(Name = &quot;姓名&quot;)]</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        [CheckValidAge]</span><br><span class="line">        [Display(Name = &quot;年齡&quot;)]</span><br><span class="line">        public int Age &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class CheckValidAge : ValidationAttribute</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        public CheckValidAge()</span><br><span class="line">        &#123;</span><br><span class="line">            ErrorMessage = &quot;年齡不可超過50歲&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override bool IsValid(object value)</span><br><span class="line">        &#123;</span><br><span class="line">            if (value == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            int age = (int)value;</span><br><span class="line">            if (age &gt; 50)</span><br><span class="line">            &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如此一來，送出如果&gt;50就會顯示出錯誤。</p>
<img src="/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/3.gif" class="">


<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>雖然2021年的今天，大多數人都不使用這種form驗證，而是用API傳送。<br>因為頁面不用跳轉，用戶也能得到比較好的體驗。</p>
<p>然而，這種傳統的送資料方式還是有存在必要，就是系統追求安全性、穩定性，因為API方式會有比較難管理的問題。</p>
<p>此外，寫到這裡就開始有綁手綁腳的感覺<br>因為框架不那麼自由的讓你直接寫想寫的程式碼，而是照MVC架構<br>這就是一個好處，代表維護或後續開發的人就會照同條路走</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10240340">https://ithelp.ithome.com.tw/articles/10240340</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/aspnet/core/mvc/models/validation?view=aspnetcore-5.0">https://docs.microsoft.com/zh-tw/aspnet/core/mvc/models/validation?view=aspnetcore-5.0</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/10/01/C-MVC-Model%E6%A8%A1%E5%9E%8B%E9%A9%97%E8%AD%89/" data-id="cme6kwo0h0016galjessmabl1" data-title="[Day6] C# MVC Model模型驗證 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C-MVC-Model模型使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2021-09-30T04:00:51.000Z" itemprop="datePublished">2021-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/">[Day5] C# MVC Model模型使用 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/09/29/C-MVC%E7%9A%84%E7%A8%8B%E5%BC%8F%E6%9E%B6%E6%A7%8B%E6%B7%BA%E8%AB%87/" title="[Day4] C# MVC的程式架構淺談 - C#&amp;AspNetCore">[Day4] C# MVC的程式架構淺談 - C#&amp;AspNetCore</a>  ，我們談了整體的架構與檔案。<br>在這篇主要談如何在 ASP.NET Core MVC 中建立Model模型，並且使用。</p>
<h3 id="Model定義"><a href="#Model定義" class="headerlink" title="Model定義"></a>Model定義</h3><p>模型，是一個Class，在MVC裡是放資料的容器，通常會因為以下原因建立:</p>
<ol>
<li>為了對應資料庫的table schema(欄位名稱)</li>
<li>呈現頁面資料的ViewModel</li>
</ol>
<h3 id="建立Model的過程"><a href="#建立Model的過程" class="headerlink" title="建立Model的過程"></a>建立Model的過程</h3><p>1.在Models資料夾 Add &gt; New Item</p>
<img src="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/1.png" class="">
<p>2.選擇Class，然後自訂Model名稱</p>
<img src="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/2.png" class="">
<p>3.自己增加欄位ID、Name、Age、Address。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class UsersModel</span><br><span class="line">    &#123;</span><br><span class="line">        public int ID &#123; get; set; &#125;</span><br><span class="line">        public string Name &#123; get; set; &#125;</span><br><span class="line">        public int Age &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.完成，建立一個Model就是這麼簡單，再來就是使用這個Model。</p>
<h3 id="使用Model"><a href="#使用Model" class="headerlink" title="使用Model"></a>使用Model</h3><p>再來我們透過HomeController使用他。</p>
<h4 id="HomeController-cs"><a href="#HomeController-cs" class="headerlink" title="HomeController.cs"></a>HomeController.cs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;</span><br><span class="line">using Microsoft.Extensions.Logging;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using WebApplication1.Models;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    public class HomeController : Controller</span><br><span class="line">    &#123;</span><br><span class="line">        private readonly ILogger&lt;HomeController&gt; _logger;</span><br><span class="line"></span><br><span class="line">        public HomeController(ILogger&lt;HomeController&gt; logger)</span><br><span class="line">        &#123;</span><br><span class="line">            _logger = logger;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IActionResult Index()</span><br><span class="line">        &#123;</span><br><span class="line">            // 建立usersModel物件</span><br><span class="line">            UsersModel usersModel = new UsersModel()</span><br><span class="line">            &#123;</span><br><span class="line">                ID = 1,</span><br><span class="line">                Name = &quot;YU HSIANG&quot;,</span><br><span class="line">                Age = 25</span><br><span class="line">            &#125;;</span><br><span class="line">            // 傳入View</span><br><span class="line">            return View(usersModel);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IActionResult Privacy()</span><br><span class="line">        &#123;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]</span><br><span class="line">        public IActionResult Error()</span><br><span class="line">        &#123;</span><br><span class="line">            return View(new ErrorViewModel &#123; RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>23~31，透過模型Model建立規格，再把資料指派進去，傳進View中。</p>
<p>接下來要在View中使用我們傳進的Model</p>
<h5 id="Index-cshtml"><a href="#Index-cshtml" class="headerlink" title="Index.cshtml"></a>Index.cshtml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@model WebApplication1.Models.UsersModel</span><br><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Home Page&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;@Model.ID&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;@Model.Name&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;@Model.Age&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;div class=&quot;text-center&quot;&gt;</span><br><span class="line">    &lt;h1 class=&quot;display-4&quot;&gt;Welcome&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Learn about &lt;a href=&quot;https://docs.microsoft.com/aspnet/core&quot;&gt;building Web apps with ASP.NET Core&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>如此一來就能顯示我們的資料了。</p>
<img src="/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/4.png" class="">

<p>此外，通常會建立ViewModel以對應特定的View畫面。</p>
<p><strong>[補充]View型態主要分為兩種</strong><br>Type View(強型別)-compiler時就必須過，有intellisense<br>Dynamic View(動態)-intellisense不會協助，在View具有不同class的model可以使用</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>知道Model有ViewModel與table schema的用法，能夠使我們更清楚訂定需要的資料規格，讓維護或擴充時有一個良好的先天條件。@@<br>而在下篇中將會探討Model的資料驗證。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10240268">https://ithelp.ithome.com.tw/articles/10240268</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/30/C-MVC-Model%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/" data-id="cme6kwo0g0013galj030vd01t" data-title="[Day5] C# MVC Model模型使用 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C-MVC的程式架構淺談" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/29/C-MVC%E7%9A%84%E7%A8%8B%E5%BC%8F%E6%9E%B6%E6%A7%8B%E6%B7%BA%E8%AB%87/" class="article-date">
  <time class="dt-published" datetime="2021-09-28T23:05:32.000Z" itemprop="datePublished">2021-09-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Framework/">Framework</a>►<a class="article-category-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/29/C-MVC%E7%9A%84%E7%A8%8B%E5%BC%8F%E6%9E%B6%E6%A7%8B%E6%B7%BA%E8%AB%87/">[Day4] C# MVC的程式架構淺談 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>這篇主要檢討上回 <a href="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/" title="[Day3] 建立C# MVC專案 - C#&amp;AspNetCore">[Day3] 建立C# MVC專案 - C#&amp;AspNetCore</a> 透過.net core 3.1版本建立出的程式碼架構。</p>
<h3 id="檔案架構"><a href="#檔案架構" class="headerlink" title="檔案架構"></a>檔案架構</h3><ul>
<li>wwwroot資料夾: 是放置靜態檔案如js、css等前台需要的檔案</li>
<li>Controllers資料夾: 是放置MVC的控制器Controller的地方，與使用者請求並給予回應有關</li>
<li>Models資料夾: 是放置MVC的控制器Models的地方，與資料庫有緊密關係</li>
<li>Views資料夾: 是放置MVC的控制器Views的地方，在頁面上和使用者互動的畫面</li>
<li>appsetting.json 設定檔案。</li>
<li>Program.cs 主要的進入點Main的所在，在此建立Host。</li>
<li>Startup.cs 在這裡可以設定網站的啟用設定，如添加中介層(Middleware) </li>
</ul>
<img src="/2021/09/29/C-MVC%E7%9A%84%E7%A8%8B%E5%BC%8F%E6%9E%B6%E6%A7%8B%E6%B7%BA%E8%AB%87/1.png" class="">

<h3 id="程式碼探究"><a href="#程式碼探究" class="headerlink" title="程式碼探究"></a>程式碼探究</h3><h4 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Hosting;</span><br><span class="line">using Microsoft.Extensions.Configuration;</span><br><span class="line">using Microsoft.Extensions.Hosting;</span><br><span class="line">using Microsoft.Extensions.Logging;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1</span><br><span class="line">&#123;</span><br><span class="line">    public class Program</span><br><span class="line">    &#123;</span><br><span class="line">        public static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            CreateHostBuilder(args).Build().Run();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static IHostBuilder CreateHostBuilder(string[] args) =&gt;</span><br><span class="line">            Host.CreateDefaultBuilder(args)</span><br><span class="line">                .ConfigureWebHostDefaults(webBuilder =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    webBuilder.UseStartup&lt;Startup&gt;();</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Main:程式碼進入點，並在裡面呼叫<code>CreateHostBuilder</code>，建立初始化的<code>IHostBuilder</code>。之後，Build建立實體，再透過Run運行。</li>
<li>CreateDefaultBuilder:預設為空參數，也可以自行添加。</li>
<li>ConfigureWebHostDefaults:其中包含用來裝載 web 應用程式的預設值</li>
<li>UseStartup:指定要供 web 主機使用的啟動類型，這裡套用Startup.cs的程式碼，也可以自訂Class然後套用至此。</li>
</ul>
<p>小結:透過一個Console程式運行網站伺服器，可在此設定一開始要執行什麼、套用什麼設定。</p>
<h4 id="Startup-cs"><a href="#Startup-cs" class="headerlink" title="Startup.cs"></a>Startup.cs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Builder;</span><br><span class="line">using Microsoft.AspNetCore.Hosting;</span><br><span class="line">using Microsoft.AspNetCore.HttpsPolicy;</span><br><span class="line">using Microsoft.Extensions.Configuration;</span><br><span class="line">using Microsoft.Extensions.DependencyInjection;</span><br><span class="line">using Microsoft.Extensions.Hosting;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1</span><br><span class="line">&#123;</span><br><span class="line">    public class Startup</span><br><span class="line">    &#123;</span><br><span class="line">        public Startup(IConfiguration configuration)</span><br><span class="line">        &#123;</span><br><span class="line">            Configuration = configuration;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IConfiguration Configuration &#123; get; &#125;</span><br><span class="line"></span><br><span class="line">        // This method gets called by the runtime. Use this method to add services to the container.</span><br><span class="line">        public void ConfigureServices(IServiceCollection services)</span><br><span class="line">        &#123;</span><br><span class="line">            // 添加服務</span><br><span class="line">            services.AddControllersWithViews();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span><br><span class="line">        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</span><br><span class="line">        &#123;</span><br><span class="line">            if (env.IsDevelopment())</span><br><span class="line">            &#123;</span><br><span class="line">                app.UseDeveloperExceptionPage();</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                app.UseExceptionHandler(&quot;/Home/Error&quot;);</span><br><span class="line">                // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.</span><br><span class="line">                app.UseHsts();</span><br><span class="line">            &#125;</span><br><span class="line">            app.UseHttpsRedirection();</span><br><span class="line">            app.UseStaticFiles();</span><br><span class="line"></span><br><span class="line">            app.UseRouting();</span><br><span class="line"></span><br><span class="line">            app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">            app.UseEndpoints(endpoints =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                endpoints.MapControllerRoute(</span><br><span class="line">                    name: &quot;default&quot;,</span><br><span class="line">                    pattern: &quot;&#123;controller=Home&#125;/&#123;action=Index&#125;/&#123;id?&#125;&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Startup:建構式，程式進入點，裡面設定configuration(如:appsetting.json的資料就會在此被帶進來)。</li>
<li>ConfigureServices:設定添加的服務。<code>AddControllersWithViews</code>，主要用來設定添加MVC服務，舊版是AddMvc。</li>
<li>Configure:設定HTTP request pipeline，針對http請求進行設定。<ul>
<li>IsDevelopmen:套用開發版/上線版兩種模式。</li>
<li>UseHsts:將 HTTP Strict 傳輸安全性通訊協定 (HSTS) 標頭傳送給用戶端</li>
<li>UseDeveloperExceptionPage:使用開發者例外頁面</li>
<li>UseExceptionHandler:例外時導向某頁</li>
<li>UseHttpsRedirection:強制導向HTTPS</li>
<li>UseStaticFiles:會在中呼叫方法 Startup.Configure，以啟用靜態檔案的服務</li>
<li>UseRouting:將路由對應新增到Middleware中</li>
<li>UseAuthorization:授權使用端點路由傳送的資源時，此呼叫必須出現在對應用程式的呼叫之間 。UseRouting () 和 應用程式。UseEndpoints ( … ) ，讓中介軟體能夠正常運作。</li>
<li>UseEndpoints:Middleware提供了endpoints可以擴充一些方法去針對route去做設定</li>
</ul>
</li>
</ul>
<p>小結:添加哪些服務、設定一些初始架構(HTTP協定、開發版/上線版)、中介層設定都在這Startup.cs裡。</p>
<h4 id="appsettings-json"><a href="#appsettings-json" class="headerlink" title="appsettings.json"></a>appsettings.json</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;Logging&quot;: &#123;</span><br><span class="line">    &quot;LogLevel&quot;: &#123;</span><br><span class="line">      &quot;Default&quot;: &quot;Information&quot;,</span><br><span class="line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</span><br><span class="line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;AllowedHosts&quot;: &quot;*&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小結:在此建立的值可以在Startup.cs被讀取，通常是一些外部字串設定檔，像是舊版的webconfig</p>
<h4 id="HomeController-cs"><a href="#HomeController-cs" class="headerlink" title="HomeController.cs"></a>HomeController.cs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">using Microsoft.AspNetCore.Mvc;</span><br><span class="line">using Microsoft.Extensions.Logging;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using WebApplication1.Models;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    public class HomeController : Controller</span><br><span class="line">    &#123;</span><br><span class="line">        private readonly ILogger&lt;HomeController&gt; _logger;</span><br><span class="line"></span><br><span class="line">        public HomeController(ILogger&lt;HomeController&gt; logger)</span><br><span class="line">        &#123;</span><br><span class="line">            _logger = logger;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IActionResult Index()</span><br><span class="line">        &#123;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IActionResult Privacy()</span><br><span class="line">        &#123;</span><br><span class="line">            return View();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]</span><br><span class="line">        public IActionResult Error()</span><br><span class="line">        &#123;</span><br><span class="line">            return View(new ErrorViewModel &#123; RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ILogger:提供寫入log的介面，在 ASP.NET Core 統一透過 ILogger 來記錄 Log。</li>
<li>Index()、Privacy():是Controller裡的action，用來載入的View資料夾的頁面。</li>
<li>ResponseCache:設定 Response 的暫存方式。並套用到要使用 Response 快取的 Controller 或 Action。以此就是套用到Error()。</li>
<li>Error():錯誤時返回的頁面，這邊回傳了ErrorViewModel模型格式的內容。<br>[補充]C#問號用法:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int? x = null;//定義可空型別變數</span><br><span class="line">int? y = x ?? 1000;//使用合併運算子，當變數x為null時，預設賦值1000</span><br></pre></td></tr></table></figure></li>
</ul>
<p>小結:控制器可依需求返回頁面、可在此紀錄LOG。</p>
<h4 id="ErrorViewModel-cs"><a href="#ErrorViewModel-cs" class="headerlink" title="ErrorViewModel.cs"></a>ErrorViewModel.cs</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line"></span><br><span class="line">namespace WebApplication1.Models</span><br><span class="line">&#123;</span><br><span class="line">    public class ErrorViewModel</span><br><span class="line">    &#123;</span><br><span class="line">        public string RequestId &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public bool ShowRequestId =&gt; !string.IsNullOrEmpty(RequestId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ErrorViewModel:建立Class</li>
<li>RequestId:model中的string值</li>
<li>ShowRequestId:model中的bool值，返回一個lambda函式結果</li>
</ul>
<p>給View用的Model，跟MVVM概念中所提到的ViewModel是不一樣的<br>在MVC的View中，一個View Binding一個Model，如果要使用多個不同的資料表就會用到View Model。</p>
<p>小結:在此建立一些模型規格，供頁面呈現使用。</p>
<h4 id="Index-cshtml"><a href="#Index-cshtml" class="headerlink" title="Index.cshtml"></a>Index.cshtml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Home Page&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;text-center&quot;&gt;</span><br><span class="line">    &lt;h1 class=&quot;display-4&quot;&gt;Welcome&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;Learn about &lt;a href=&quot;https://docs.microsoft.com/aspnet/core&quot;&gt;building Web apps with ASP.NET Core&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>ViewData:引用System.Web.Mvc.ViewDataDictionary，屬於Dictionary Object，能放Property或是一個Model的IEnumerable，使用Key/Value的概念存取。生命週期為一個頁面</li>
<li>@{}區塊:Razor語法，可以在裡面寫C#語法，但建議前台盡量少業務邏輯、只以純顯示為幕的比較好。</li>
</ul>
<p>小結:在此可以寫html、前端畫面。</p>
<h3 id="Privacy-cshtml"><a href="#Privacy-cshtml" class="headerlink" title="Privacy.cshtml"></a>Privacy.cshtml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Privacy Policy&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;h1&gt;@ViewData[&quot;Title&quot;]&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Use this page to detail your site&#x27;s privacy policy.&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>@ViewData:可用Razor語法叫出值顯示。</li>
</ul>
<p>小結:同 Index.cshtml</p>
<h3 id="Layout-cshtml"><a href="#Layout-cshtml" class="headerlink" title="_Layout.cshtml"></a>_Layout.cshtml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;@ViewData[&quot;Title&quot;] - WebApplication1&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/lib/bootstrap/dist/css/bootstrap.min.css&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">        &lt;nav class=&quot;navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">                &lt;a class=&quot;navbar-brand&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;WebApplication1&lt;/a&gt;</span><br><span class="line">                &lt;button class=&quot;navbar-toggler&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;.navbar-collapse&quot; aria-controls=&quot;navbarSupportedContent&quot;</span><br><span class="line">                        aria-expanded=&quot;false&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;navbar-toggler-icon&quot;&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                &lt;div class=&quot;navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse&quot;&gt;</span><br><span class="line">                    &lt;ul class=&quot;navbar-nav flex-grow-1&quot;&gt;</span><br><span class="line">                        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                            &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Index&quot;&gt;Home&lt;/a&gt;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                        &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                            &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">                        &lt;/li&gt;</span><br><span class="line">                    &lt;/ul&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;main role=&quot;main&quot; class=&quot;pb-3&quot;&gt;</span><br><span class="line">            @RenderBody()</span><br><span class="line">        &lt;/main&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;footer class=&quot;border-top footer text-muted&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">            &amp;copy; 2021 - WebApplication1 - &lt;a asp-area=&quot;&quot; asp-controller=&quot;Home&quot; asp-action=&quot;Privacy&quot;&gt;Privacy&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/lib/bootstrap/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;~/js/site.js&quot; asp-append-version=&quot;true&quot;&gt;&lt;/script&gt;</span><br><span class="line">    @RenderSection(&quot;Scripts&quot;, required: false)</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>@ViewData[“Title”]:底下頁面PASS過來的Title。</li>
<li>@RenderBody():把整塊子頁面放進來。</li>
<li>@RenderSection():建立放js區塊的程式碼區域，required表示是否一定要提供。</li>
</ul>
<p>小結:共用的頁面主架構。</p>
<h4 id="ValidationScriptsPartial-cshtml"><a href="#ValidationScriptsPartial-cshtml" class="headerlink" title="_ValidationScriptsPartial.cshtml"></a>_ValidationScriptsPartial.cshtml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;~/lib/jquery-validation/dist/jquery.validate.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>小結:放切出來的區塊。</p>
<h4 id="Error-cshtml"><a href="#Error-cshtml" class="headerlink" title="Error.cshtml"></a>Error.cshtml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@model ErrorViewModel</span><br><span class="line">@&#123;</span><br><span class="line">    ViewData[&quot;Title&quot;] = &quot;Error&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;h1 class=&quot;text-danger&quot;&gt;Error.&lt;/h1&gt;</span><br><span class="line">&lt;h2 class=&quot;text-danger&quot;&gt;An error occurred while processing your request.&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">@if (Model.ShowRequestId)</span><br><span class="line">&#123;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;strong&gt;Request ID:&lt;/strong&gt; &lt;code&gt;@Model.RequestId&lt;/code&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;Development Mode&lt;/h3&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    Swapping to &lt;strong&gt;Development&lt;/strong&gt; environment will display more detailed information about the error that occurred.</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;strong&gt;The Development environment shouldn&#x27;t be enabled for deployed applications.&lt;/strong&gt;</span><br><span class="line">    It can result in displaying sensitive information from exceptions to end users.</span><br><span class="line">    For local debugging, enable the &lt;strong&gt;Development&lt;/strong&gt; environment by setting the &lt;strong&gt;ASPNETCORE_ENVIRONMENT&lt;/strong&gt; environment variable to &lt;strong&gt;Development&lt;/strong&gt;</span><br><span class="line">    and restarting the app.</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>@model:Razor語法，可以使用model的物件<br>小結:套用了ErrorViewModel，主要印出ErrorViewModel內的資料。</p>
<h4 id="ViewImports-cshtml"><a href="#ViewImports-cshtml" class="headerlink" title="_ViewImports.cshtml"></a>_ViewImports.cshtml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@using WebApplication1</span><br><span class="line">@using WebApplication1.Models</span><br><span class="line">@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers</span><br></pre></td></tr></table></figure>
<p>小結:設定使用那些程式模組</p>
<h4 id="ViewStart-cshtml"><a href="#ViewStart-cshtml" class="headerlink" title="_ViewStart.cshtml"></a>_ViewStart.cshtml</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@&#123;</span><br><span class="line">    Layout = &quot;_Layout&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>小結:頁面進入點套用。</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>從程式碼片段中可以得知整個架構上如何運作。<br>從一開始的Console建置啟動程式、Startup設定，至單個頁面程式碼符合MVC架構的撰寫，最後運行起整個系統。</p>
<p>因為MVC所以知道這設計模式的人就能很快的熟悉這架構的寫法與邏輯。<br>如果是自幹的專案，就會有這地方是什麼架構、要怎麼改的才能達到功能的各種歪路。</p>
<p>預計下回會針對在Model、View、Controller上的細節程式碼撰寫。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://www.tutorialsteacher.com/core/aspnet-core-startup">https://www.tutorialsteacher.com/core/aspnet-core-startup</a><br><a target="_blank" rel="noopener" href="https://blog.johnwu.cc/article/asp-net-core-3-application-lifetime.html">https://blog.johnwu.cc/article/asp-net-core-3-application-lifetime.html</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10240077">https://ithelp.ithome.com.tw/articles/10240077</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-tw/dotnet/api/microsoft.extensions.hosting.host.createdefaultbuilder?view=dotnet-plat-ext-5.0">https://docs.microsoft.com/zh-tw/dotnet/api/microsoft.extensions.hosting.host.createdefaultbuilder?view=dotnet-plat-ext-5.0</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10243332">https://ithelp.ithome.com.tw/articles/10243332</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10186520">https://ithelp.ithome.com.tw/articles/10186520</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/29/C-MVC%E7%9A%84%E7%A8%8B%E5%BC%8F%E6%9E%B6%E6%A7%8B%E6%B7%BA%E8%AB%87/" data-id="cme6kwo0z0027galj69gi043i" data-title="[Day4] C# MVC的程式架構淺談 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-建立C-MVC專案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2021-09-28T09:03:14.000Z" itemprop="datePublished">2021-09-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Code/">Code</a>►<a class="article-category-link" href="/categories/Code/C/">C#</a>►<a class="article-category-link" href="/categories/Topic/">Topic</a>►<a class="article-category-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/">[Day3] 建立C# MVC專案 - C#&amp;AspNetCore</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在上回 <a href="/2021/09/21/%E4%BB%80%E9%BA%BC%E6%98%AFMVC/" title="[Day2] 什麼是MVC，有什麼好處 - C#&amp;AspNetCore">[Day2] 什麼是MVC，有什麼好處 - C#&amp;AspNetCore</a> 中我們理解到的MVC的核心概念。<br>在這回中我們要利用Visual Studio來建立一個C# MVC專案，並運行起來。</p>
<h3 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h3><p>Visual Studio Community 2019:<br><a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/zh-hant/downloads/">https://visualstudio.microsoft.com/zh-hant/downloads/</a></p>
<h3 id="建立專案"><a href="#建立專案" class="headerlink" title="建立專案"></a>建立專案</h3><p>1.下載完後就可以開啟Visual Studio建立專案，New&gt;Project</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/1.png" class="">
<p>2.選ASP.NET Core Web App(Model-View-Controller)，不然會建立出傳統沒有設計模式(Design Pattern)架構的專案。</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/2.png" class="">
<p>3.設定專案名稱及資料夾</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/3.png" class="">
<p>4.Enable Razor runtime compilation 執行期編譯要記得打勾，不然每次要重新執行才能看到修改的結果。</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/4.png" class="">
<p>5.專案建立</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/5.png" class="">
<p>6.可看見Model、View、Controller</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/6.png" class="">
<p>7.點下Express執行</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/7.png" class="">
<p>8.成功運行在網頁上了!</p>
<img src="/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/8.png" class="">


<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>建立MVC專案成功!<br>相對於PHP的LARAVEL框架來說，這套建立起來的MVC系統比較輕量，也就代表未來擴充的程式碼要設計好，否則量大起來加上多人協作可能就會有難以維護的問題。<br>為了在維護、co-work好改，之後也會注重在設計模式上。<br>最後，對於微軟程式只要能用IDE運行起來就成功一半了。因為程式碼除錯、追蹤功能強大。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/28/%E5%BB%BA%E7%AB%8BC-MVC%E5%B0%88%E6%A1%88/" data-id="cme6kwo3y007qgalj5vfu4760" data-title="[Day3] 建立C# MVC專案 - C#&amp;AspNetCore" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-基礎資料結構" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/" class="article-date">
  <time class="dt-published" datetime="2021-09-25T20:10:11.000Z" itemprop="datePublished">2021-09-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Computer-Science/">Computer Science</a>►<a class="article-category-link" href="/categories/Computer-Science/Data-structure/">Data structure</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/">基礎資料結構</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>資料結構:</strong></p>
<ol>
<li>如何在電腦中儲存資料。</li>
<li>是一種工具，如:演算法搭配適合的資料結構。</li>
</ol>
<p><strong>選擇不同的資料結構:</strong></p>
<ol>
<li>時間複雜度:非常頻繁拿、取，希望時間可以短一點。</li>
<li>空間複雜度:需要另外用空間來加速，那空間可能要比較多。</li>
<li>coding複雜度:比如有兩種結構可以實作這程式，那選較容易、不容易出錯的那個。</li>
</ol>
<h3 id="常見操作"><a href="#常見操作" class="headerlink" title="常見操作"></a>常見操作</h3><p>push放入一個元素、pop取出一個元素、query查詢</p>
<h3 id="堆疊"><a href="#堆疊" class="headerlink" title="堆疊"></a>堆疊</h3><p>堆疊(stack，FILO，first in last out)，先進後出，如碟盤子。<br>實作搭配linked list<br>push:在head插入一個節點<br>pop:刪除head指向的節點<br>時間複雜度:<br>push:O(1)<br>pop:O(1)</p>
<h3 id="佇列"><a href="#佇列" class="headerlink" title="佇列"></a>佇列</h3><p>佇列(queue，FIFO，first in first out)，先進先出，如排隊。有環狀、單向之分。<br>實作搭配linked list或環狀佇列。<br>push:在end後面插入一個節點<br>pop:刪除head指向的節點<br>時間複雜度:<br>enqueue:O(1)<br>dequeue:O(1)</p>
<h3 id="鏈結串列"><a href="#鏈結串列" class="headerlink" title="鏈結串列"></a>鏈結串列</h3><p>鏈結串列(linked list)。<br>基本單元:Node(data+pointer)<br>將很多Node接起。<br>head指向第一個node，最後一個指標指向NULL。</p>
<img src="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/linked-list.png" class="">
<p>性質:</p>
<ol>
<li>每個元素只記錄他下一個元素，外部只記錄起點(head)</li>
<li>動態宣告記憶體，需要時就要，不需要就還給系統</li>
<li>分類:單向、雙向、環狀</li>
<li>不能隨機存取，因為外部只記錄起點(head)，所以只能從頭去一個一個下去找，第一個告訴我第二個在哪，第二個告訴我第三個在哪…。</li>
</ol>
<p>操作:<br>insert新增元素，在兩個元素間，或是頭、尾插入<br>delete刪除元素</p>
<p>時間複雜度:<br>insert:O(1)，只要重新更改pointer指向<br>delete:O(1)，只要重新更改pointer指向</p>
<p>為什麼不用陣列，還能隨機存取?<br>1.避免記憶體浪費，但array的dynamic array也能做到<br>2.可以快速刪除、插入節點，這array沒辦法做到。</p>
<p>下面兩個是延伸，不過要控制的資料變多，可能維護下來除起bug的機率會高。</p>
<h5 id="雙向鏈結串列"><a href="#雙向鏈結串列" class="headerlink" title="雙向鏈結串列"></a>雙向鏈結串列</h5><img src="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/linked-list2.png" class="">
<h5 id="環狀鏈結串列"><a href="#環狀鏈結串列" class="headerlink" title="環狀鏈結串列"></a>環狀鏈結串列</h5><img src="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/linked-list3.png" class="">
<h3 id="時間複雜度比較"><a href="#時間複雜度比較" class="headerlink" title="時間複雜度比較"></a>時間複雜度比較</h3><img src="/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/array-vs-linkedlist.png" class="">
<p>此外，兩個linked list合併速度很快，因為只要指向另一個的頭即可，只要O(1)。</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>從這章中理解到為什麼要用資料結構，選用適合的資料結構可以改善程式的速度、程式碼難易度。在前面這幾篇中預計以理解原理為主，底層實作則未來有時間再另外拿出來寫。</p>
<p>如果是頻繁讀取，可以用array；如果頻繁新增、刪除，可以用linked list。</p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=EH5XO2iYJvM">https://www.youtube.com/watch?v=EH5XO2iYJvM</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/26/%E5%9F%BA%E7%A4%8E%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B/" data-id="cme6kwo3u007igalj7uoifsd2" data-title="基礎資料結構" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-演算法複雜度" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/25/%E6%BC%94%E7%AE%97%E6%B3%95%E8%A4%87%E9%9B%9C%E5%BA%A6/" class="article-date">
  <time class="dt-published" datetime="2021-09-24T18:53:26.000Z" itemprop="datePublished">2021-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Computer-Science/">Computer Science</a>►<a class="article-category-link" href="/categories/Computer-Science/Algorithm/">Algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/25/%E6%BC%94%E7%AE%97%E6%B3%95%E8%A4%87%E9%9B%9C%E5%BA%A6/">Big-O 複雜度分析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="好程式的迷思"><a href="#好程式的迷思" class="headerlink" title="好程式的迷思"></a>好程式的迷思</h3><p>一個程式好不好通常看你要解決的問題。</p>
<ol>
<li>時間花得少(運行速度) ex:網頁跑很快、資料載入快</li>
<li>空間花得少 ex:硬體不夠充裕，要使用比較少記憶體</li>
<li>正確率較高 ex:防毒軟體隊攻擊作防範、更高機率偵測</li>
<li>相容性較高 ex:好延伸擴充、裡面程式太複雜造成很難擴充</li>
<li>開發成本低 ex:開發軟體時，很快的做法但寫起來很困難，普通速度的作法但寫起來容易。</li>
</ol>
<p>所以要適當的平衡，並不是哪種一定是好。<br>相容性、開發成本，通常仰賴當下開發者評估。<br>正確率則是在實作的細節上、Case量、理論分析上。</p>
<h3 id="複雜度概念"><a href="#複雜度概念" class="headerlink" title="複雜度概念"></a>複雜度概念</h3><p>把所有操作都視為一樣的時間，如:加減乘除、位運算、存取記憶體、判斷運算子…等<br>把所有操作次數計算出來。<br>看量級大小，來評估執行時間。有些程式容易TLE超時就是因為這問題，比較在意的是量級，而不是精確的值。</p>
<p>舉例:被指派長期作業，有兩種方案可選:</p>
<ol>
<li>每天算10題。</li>
<li>第一天算1題，第二天算2題，第三天算3題…。</li>
</ol>
<p><strong>兩種方案怎麼選?</strong><br>如果每算一題要5秒<br>第n天:</p>
<ol>
<li>10 * n * 5 = 50n</li>
<li>(n+1) * n/2 * 5 = 2.5(n^2+n)</li>
</ol>
<p>n=5天時，</p>
<ol>
<li>250秒</li>
<li>75秒</li>
</ol>
<p>n=365天時，</p>
<ol>
<li>18250秒</li>
<li>333975秒</li>
</ol>
<p>可以發現操作數的量級(複雜)比較多，所以以長期來看會是方案1比較好。</p>
<h3 id="量級概念"><a href="#量級概念" class="headerlink" title="量級概念"></a>量級概念</h3><p>成長的速度不同等級。<br>如f(n)與g(n)兩個函數，當n趨近無窮大，誰會比較大?</p>
<ol>
<li>3n^2+n+20 vs 100n 如果n = 10000，左邊會變成億；右邊只有百萬，所以左邊量級大</li>
<li>n^100 vs 2^n</li>
<li>n^2 vs 10nlogn</li>
<li>100^n vs n! 如果n=200，左邊100倍，右邊成長200倍，所以右邊量級大於左邊。</li>
<li>30*2^n vs 3^n</li>
<li>100n vs 200n 同一量級，因為極限的概念</li>
</ol>
<p><strong>極限概念</strong></p>
<p>如果f(n)/g(n)，n趨近無限大時趨近0，那麼說f(n)比g(n)小。<br>如果f(n)/g(n)，n趨近無限大時趨近無限大，那麼說f(n)比g(n)大。<br>否則稱作兩者一樣量級。<br>所以，100n/200n = 1/2，所以不管n多大都一樣，稱作一樣量級。<br>但是，科技進步可以補100n與200n的差異，如平行運算可能可以把100n與200n的作法都視為一樣。但如果不是同一量級，還是會有科技進步彌補不了的，如上面的例子1。</p>
<h3 id="量級的比較"><a href="#量級的比較" class="headerlink" title="量級的比較"></a>量級的比較</h3><p>以一台每秒可以進行10億次運算的電腦:</p>
<img src="/2021/09/25/%E6%BC%94%E7%AE%97%E6%B3%95%E8%A4%87%E9%9B%9C%E5%BA%A6/%E9%87%8F%E7%B4%9A%E6%AF%94%E8%BC%83.png" class="">
<p>所以好算法、壞算法需要的時間是有很大差距的。</p>
<h3 id="大歐符號-Big-O"><a href="#大歐符號-Big-O" class="headerlink" title="大歐符號 Big-O"></a>大歐符號 Big-O</h3><p>記為O(f(n))，f(n)為複雜度量級的”上界”。所以實際結果可能會比他還要小。<br>常數會省略只寫一個n</p>
<ol>
<li>3n^3+5n^2+10n+3 ∈ O(n^3)</li>
<li>f(n) ∈ O(n^2)，則f(n) ∈ O(n^3)，因為是上界</li>
<li>1000 ∈ O(1) </li>
</ol>
<p>ps.最緊上界:如果一個算法同時是O(n^2)算法、O(n^3)算法，通常會取比較小的O(n^2)，以避免過度悲觀評估。&lt;&lt;=這句我不太懂</p>
<ol>
<li>3n^2+n+20 vs 100n ；O(n^2) vs O(n)</li>
<li>n^2 vs 10nlogn；O(n^2) vs O(nlogn)</li>
<li>100^n vs n! ；O(100^n) vs O(n!)</li>
<li>30*2^n vs 3^n ；O(2^n) vs O(3^n)</li>
<li>100n vs 200n ；O(n) vs O(n)</li>
</ol>
<p>常見的時間複雜度函式:</p>
<img src="/2021/09/25/%E6%BC%94%E7%AE%97%E6%B3%95%E8%A4%87%E9%9B%9C%E5%BA%A6/%E9%87%8F%E7%B4%9A%E6%AF%94%E8%BC%83%E7%AF%84%E4%BE%8B%E5%9C%96.png" class="">

<h3 id="如果時間不穩定"><a href="#如果時間不穩定" class="headerlink" title="如果時間不穩定"></a>如果時間不穩定</h3><p>如一個人姓名存在資料庫，想找到那個人<br>如果是排第一個情況，O(1)<br>如果是排最後一個情況，O(n)</p>
<p>多數關注的是最壞的case，如:插入排序，最好是O(n)；最壞是O(n^2)</p>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>從參考資料中整理的一些對演算法複雜度的知識。<br>如果有機會寫到要追求「時間花得少」或「空間花得少」時就能派上用場，但這些通常使用在底層實作上，在應用的層面非常少用到，不過能透過理解複雜度，盡量選擇好的實踐方法。</p>
<p>此外，在應用層面上，相容性較高、開發成本低，我認為比較重要；底層函式庫則是追求時間花得少、空間花得少。所以，看是寫哪個層面的程式，如果兩者反過來會蠻可怕的。</p>
<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A4%A7O%E7%AC%A6%E5%8F%B7">https://zh.wikipedia.org/wiki/%E5%A4%A7O%E7%AC%A6%E5%8F%B7</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?app=desktop&amp;v=_r7cfVrn28c">https://www.youtube.com/watch?app=desktop&amp;v=_r7cfVrn28c</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6">https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/25/%E6%BC%94%E7%AE%97%E6%B3%95%E8%A4%87%E9%9B%9C%E5%BA%A6/" data-id="cme6kwo430082galjdred2hwc" data-title="Big-O 複雜度分析" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-無限階層留言資料表規劃" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/23/%E7%84%A1%E9%99%90%E9%9A%8E%E5%B1%A4%E7%95%99%E8%A8%80%E8%B3%87%E6%96%99%E8%A1%A8%E8%A6%8F%E5%8A%83/" class="article-date">
  <time class="dt-published" datetime="2021-09-22T16:17:56.000Z" itemprop="datePublished">2021-09-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Database/">Database</a>►<a class="article-category-link" href="/categories/Database/SQL-Server/">SQL Server</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/23/%E7%84%A1%E9%99%90%E9%9A%8E%E5%B1%A4%E7%95%99%E8%A8%80%E8%B3%87%E6%96%99%E8%A1%A8%E8%A6%8F%E5%8A%83/">無限階層留言規劃，含資料表設計</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>這個議題算是只要有留言系統，並且想實作無限層級的留言都會碰到的。<br>如:Facebook的留言、wordpress的留言。<br>當然也有簡單類的留言，只有一層的，如:古早的無名小站，但這不是我們今天要探討的。<br>就單刀直入了，如何實作「無限階層的留言」。</p>
<h3 id="資料表"><a href="#資料表" class="headerlink" title="資料表"></a>資料表</h3><p>只要一張comments表加上parent_id即可，如下。<br>再來就可以利用程式方式(遞迴或迴圈)去印出他。</p>
<img src="/2021/09/23/%E7%84%A1%E9%99%90%E9%9A%8E%E5%B1%A4%E7%95%99%E8%A8%80%E8%B3%87%E6%96%99%E8%A1%A8%E8%A6%8F%E5%8A%83/nested-comments.png" class="">

<h3 id="程式部分"><a href="#程式部分" class="headerlink" title="程式部分"></a>程式部分</h3><p>把comments當主表，撈出資料SQL:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">users.name,</span><br><span class="line">comments.id,</span><br><span class="line">comments.comment_parent_id,</span><br><span class="line">comments.title,</span><br><span class="line">comments.content</span><br><span class="line">from comments left join users on comments.user_id = users.id</span><br></pre></td></tr></table></figure>

<p>把上面資料表進行關聯後撈出後的資料:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;id:1,comment_parent_id:null,title:&#x27;留言1&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人A&#x27;&#125;,</span><br><span class="line">    &#123;id:2,comment_parent_id:null,title:&#x27;留言2&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人B&#x27;&#125;,</span><br><span class="line">    &#123;id:3,comment_parent_id:2,title:&#x27;留言3&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人C&#x27;&#125;,</span><br><span class="line">    &#123;id:4,comment_parent_id:3,title:&#x27;留言4&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人D&#x27;&#125;,</span><br><span class="line">    &#123;id:5,comment_parent_id:3,title:&#x27;留言5&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人E&#x27;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>再來就可以實作程式碼了，我們要先把上面SQL撈出來的「打平結構」變成「樹狀結構」。<br>這會需要使用到遞迴。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Page Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const commentList = [</span><br><span class="line">    &#123;id:1,comment_parent_id:null,title:&#x27;留言1&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人A&#x27;&#125;,</span><br><span class="line">    &#123;id:2,comment_parent_id:null,title:&#x27;留言2&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人B&#x27;&#125;,</span><br><span class="line">    &#123;id:3,comment_parent_id:2,title:&#x27;留言3&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人C&#x27;&#125;,</span><br><span class="line">    &#123;id:4,comment_parent_id:3,title:&#x27;留言4&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人D&#x27;&#125;,</span><br><span class="line">    &#123;id:5,comment_parent_id:3,title:&#x27;留言5&#x27;,content:&#x27;內容&#x27;,name:&#x27;路人E&#x27;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// 建立樹狀階層</span><br><span class="line">function buildTree(commentList)&#123;</span><br><span class="line">    // 根節點</span><br><span class="line">    const rootNode = commentList.filter(it=&gt; it.comment_parent_id === null)</span><br><span class="line">    // 增加子節點</span><br><span class="line">    return addNode(rootNode,commentList)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 添加子節點</span><br><span class="line">function addNode(children,commentList)&#123;</span><br><span class="line">    // 找不到子節點返回</span><br><span class="line">    if(children.length === 0)&#123;</span><br><span class="line">    	return []</span><br><span class="line">    &#125;</span><br><span class="line">    // 添加子節點</span><br><span class="line">    const arr = [] </span><br><span class="line">    // 遍歷當前children節點</span><br><span class="line">    for(let i=0;i&lt;children.length;i++)&#123;</span><br><span class="line">    	// 查詢底下的子節點</span><br><span class="line">        const childrenNode = commentList.filter(it=&gt; </span><br><span class="line">        it.comment_parent_id === children[i].id)</span><br><span class="line">        // 把底下子節點添加進陣列</span><br><span class="line">        arr.push(&#123;</span><br><span class="line">            id:children[i].id,</span><br><span class="line">            name:children[i].name,</span><br><span class="line">            title:children[i].title,</span><br><span class="line">            content:children[i].content,</span><br><span class="line">            children:addNode(childrenNode,commentList)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    // 返回子節點陣列</span><br><span class="line">    return arr</span><br><span class="line">&#125;</span><br><span class="line">// 印出結果</span><br><span class="line">console.log(JSON.stringify(buildTree(commentList)));</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>轉成樹狀階層後的資料:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;name&quot;: &quot;路人A&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;留言1&quot;,</span><br><span class="line">        &quot;content&quot;: &quot;內容&quot;,</span><br><span class="line">        &quot;children&quot;: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;id&quot;: 2,</span><br><span class="line">        &quot;name&quot;: &quot;路人B&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;留言2&quot;,</span><br><span class="line">        &quot;content&quot;: &quot;內容&quot;,</span><br><span class="line">        &quot;children&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: 3,</span><br><span class="line">                &quot;name&quot;: &quot;路人C&quot;,</span><br><span class="line">                &quot;title&quot;: &quot;留言3&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;內容&quot;,</span><br><span class="line">                &quot;children&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: 4,</span><br><span class="line">                        &quot;name&quot;: &quot;路人D&quot;,</span><br><span class="line">                        &quot;title&quot;: &quot;留言4&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;內容&quot;,</span><br><span class="line">                        &quot;children&quot;: []</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: 5,</span><br><span class="line">                        &quot;name&quot;: &quot;路人E&quot;,</span><br><span class="line">                        &quot;title&quot;: &quot;留言5&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;內容&quot;,</span><br><span class="line">                        &quot;children&quot;: []</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>光轉成上面那串，就想了快3小時的遞迴，然後上網找些範例參考才組出來。<br>我當時的疑問就是:「怎麼讓遞迴去回傳整包陣列」，所幸有找到參考，然後小改自己程式就成功了。</p>
<p>再來就是把上面那階層式資料在網頁上印出來。<br>還是要用遞迴。</p>
<h3 id="網頁上內容呈現"><a href="#網頁上內容呈現" class="headerlink" title="網頁上內容呈現"></a>網頁上內容呈現</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Page Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;comment&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">const commentList = [</span><br><span class="line">    &#123; id: 1, comment_parent_id: null, title: &#x27;留言1&#x27;, content: &#x27;內容&#x27;, name: &#x27;路人A&#x27; &#125;,</span><br><span class="line">    &#123; id: 2, comment_parent_id: null, title: &#x27;留言2&#x27;, content: &#x27;內容&#x27;, name: &#x27;路人B&#x27; &#125;,</span><br><span class="line">    &#123; id: 3, comment_parent_id: 2, title: &#x27;留言3&#x27;, content: &#x27;內容&#x27;, name: &#x27;路人C&#x27; &#125;,</span><br><span class="line">    &#123; id: 4, comment_parent_id: 3, title: &#x27;留言4&#x27;, content: &#x27;內容&#x27;, name: &#x27;路人D&#x27; &#125;,</span><br><span class="line">    &#123; id: 5, comment_parent_id: 3, title: &#x27;留言5&#x27;, content: &#x27;內容&#x27;, name: &#x27;路人E&#x27; &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// 建立樹狀階層</span><br><span class="line">function buildTree(commentList) &#123;</span><br><span class="line">    // 根節點</span><br><span class="line">    const rootNode = commentList.filter(it =&gt; it.comment_parent_id === null)</span><br><span class="line">    // 增加子節點</span><br><span class="line">    return addNode(rootNode, commentList)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 添加子節點</span><br><span class="line">function addNode(children, commentList) &#123;</span><br><span class="line">    // 找不到子節點返回</span><br><span class="line">    if (children.length === 0) &#123;</span><br><span class="line">        return []</span><br><span class="line">    &#125;</span><br><span class="line">    // 添加子節點</span><br><span class="line">    const arr = []</span><br><span class="line">    // 遍歷當前children節點</span><br><span class="line">    for (let i = 0; i &lt; children.length; i++) &#123;</span><br><span class="line">        // 查詢底下的子節點</span><br><span class="line">        const childrenNode = commentList.filter(it =&gt;</span><br><span class="line">            it.comment_parent_id === children[i].id)</span><br><span class="line">        // 把底下子節點添加進陣列</span><br><span class="line">        arr.push(&#123;</span><br><span class="line">            id: children[i].id,</span><br><span class="line">            name: children[i].name,</span><br><span class="line">            title: children[i].title,</span><br><span class="line">            content: children[i].content,</span><br><span class="line">            children: addNode(childrenNode, commentList)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    // 返回子節點陣列</span><br><span class="line">    return arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 在網頁上呈現出結果</span><br><span class="line">function generateCommentTemplate(children) &#123;</span><br><span class="line">    let template = &#x27;&lt;ul&gt;&#x27;</span><br><span class="line">    for (let i = 0; i &lt; children.length; i++) &#123;</span><br><span class="line">        template += &#x27;&lt;li&gt;&#x27;</span><br><span class="line">        template += children[i].title + &#x27;&lt;br&gt;&#x27;</span><br><span class="line">        template += children[i].content + &#x27;&lt;br&gt;&#x27;</span><br><span class="line">        template += children[i].name + &#x27;&lt;br&gt;&#x27;</span><br><span class="line"></span><br><span class="line">        // 如果有子節點則遞迴再次呼叫</span><br><span class="line">        if (children[i].children.length !== 0) &#123;</span><br><span class="line">            template += generateCommentTemplate(children[i].children)</span><br><span class="line">        &#125;</span><br><span class="line">        template += &#x27;&lt;/li&gt;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    template += &#x27;&lt;/ul&gt;&#x27;</span><br><span class="line">    return template</span><br><span class="line">&#125;</span><br><span class="line">// 建立樹狀結構</span><br><span class="line">const tree = buildTree(commentList)</span><br><span class="line">// 產生HTML模板</span><br><span class="line">document.getElementById(&quot;comment&quot;).innerHTML = generateCommentTemplate(tree)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>輸出結果:</strong></p>
<img src="/2021/09/23/%E7%84%A1%E9%99%90%E9%9A%8E%E5%B1%A4%E7%95%99%E8%A8%80%E8%B3%87%E6%96%99%E8%A1%A8%E8%A6%8F%E5%8A%83/demo.png" class="">


<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>整篇大概花了5小時左右寫完，算是網頁系統裡最難的”遞迴”。<br>在網路上查，很難有一篇現成完整範例T_T，所以在這篇中就把整套都放上來。<br>同時練習對於樹的掌握。</p>
<p>流程如下:<br>1.規劃無限階層的留言 - 約10分鐘<br>2.樹的組合(遞迴) - 約3小時<br>3.轉譯成HTML模板(遞迴) - 約30分鐘</p>
<p>總之，有點成就感，因為真的不好寫。<br>如果後端一開始吐給你的是已經階層化的，那就很輕鬆了，因為那段的遞迴比較簡單。</p>
<p>ps.這留言的實作方法也能用來處理分類、類別、側邊欄，就內文改一下即可。</p>
<p>我有封裝了方法變成一隻.js函式庫，可以直接拿去用。<br><a target="_blank" rel="noopener" href="https://github.com/yuhsiang237/buildTree.js">https://github.com/yuhsiang237/buildTree.js</a></p>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://blog.51cto.com/dd118/2095671">https://blog.51cto.com/dd118/2095671</a><br><a target="_blank" rel="noopener" href="https://kevintsengtw.blogspot.com/2013/07/aspnet-mvc-jquery-easy-ui-tree-json.html">https://kevintsengtw.blogspot.com/2013/07/aspnet-mvc-jquery-easy-ui-tree-json.html</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10028129">https://ithelp.ithome.com.tw/articles/10028129</a><br><a target="_blank" rel="noopener" href="https://itw01.com/UBNZIEU.html">https://itw01.com/UBNZIEU.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://yuhsiang237.github.io/2021/09/23/%E7%84%A1%E9%99%90%E9%9A%8E%E5%B1%A4%E7%95%99%E8%A8%80%E8%B3%87%E6%96%99%E8%A1%A8%E8%A6%8F%E5%8A%83/" data-id="cme6kwo440085galj9gmaerht" data-title="無限階層留言規劃，含資料表設計" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/9/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/11/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a><span class="category-list-count">77</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Code/C/">C#</a><span class="category-list-count">69</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/Javascript/">Javascript</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/Refactoring/">Refactoring</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/Typescript/">Typescript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Science/">Computer Science</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Science/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Science/Data-structure/">Data structure</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Science/Electronic-Circuit/">Electronic Circuit</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Daily-Log/">Daily Log</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><span class="category-list-count">57</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Database/PostgreSQL/">PostgreSQL</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/SQL-Server/">SQL Server</a><span class="category-list-count">47</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/">Framework</a><span class="category-list-count">27</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/AspNetCore-API/">AspNetCore API</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Framework/AspNetCore-MVC/">AspNetCore MVC</a><span class="category-list-count">21</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/">Topic</a><span class="category-list-count">77</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/2021-C-AspNetCore-Challenge/">2021 C# AspNetCore Challenge</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/2021-SQL-Server-Challenge/">2021 SQL Server Challenge</a><span class="category-list-count">30</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/2022-C-SyncAndAsync/">2022 C# SyncAndAsync</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/2025-Typescript/">2025 Typescript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/Big-Data/">Big Data</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/LeetCode/">LeetCode</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Topic/SystemStructure/">SystemStructure</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">46</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">12</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Yu Hsiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>